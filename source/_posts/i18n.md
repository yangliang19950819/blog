---
title: 基于react实现i18n以及如何支持i18n-ally
cover: /img/shoe.jpg
---

### 手写 i18n 代码

- 根据 url 标识来判断语言环境
- 获取对应的语言正则递归替换
- 返回翻译之后的内容

```ts
import { useRouter } from "next/router";
import En from "@/locales/en";
import Zh from "@/locales/zh";
import { useCallback } from "react";

interface typeParams {
  [key: string]: string | number;
}
interface ILanguageMap {
  [key: string]: typeParams;
}

const LanguageMap: ILanguageMap = {
  en: En,
  zh: Zh,
};

const useTranslation: () => {
  t: (key: string, params?: typeParams | (string | number)[]) => string;
  isEn: boolean;
  isZh: boolean;
} = () => {
  const router = useRouter();
  const jsonFun = useCallback(
    (key: string, params?: typeParams | (string | number)[]) => {
      let value = "";
      if (LanguageMap[`${router.locale as "zh" | "en"}`]) {
        value = LanguageMap[`${router.locale as "zh" | "en"}`][
          `${key}`
        ] as string;
      }

      if (!key || !value) return key; // 没找到就直接返回key

      if (typeof value !== "string") return value; // 如果非string，直接返回，即ReactNode

      // 正则循环替换
      if (params) {
        Object.keys(params).forEach((item) => {
          // 数组
          if (Array.isArray(params)) {
            value = String(value).replace(
              `{${item}}`,
              String(params[Number(item)])
            );
          } else {
            value = String(value).replace(
              // eslint-disable-next-line security/detect-non-literal-regexp
              new RegExp(`{${item}}`, "g"),
              String(params[`${item}`])
            );
          }
        });
      }
      return value;
    },
    [router.locale]
  );
  return {
    t: jsonFun,
    isEn: router.locale === "en",
    isZh: router.locale === "zh",
  };
};

export default useTranslation;
```

### vscode i18n-ally 插件配置

https://github.com/lokalise/i18n-ally/wiki/Configurations

#### 由于手写的 i18n 只支持 js 或者 ts 引入翻译内容所以需要配置

```json
// other formats will be disabled regardless of the framework preference.
"i18n-ally.enabledParsers": ["js", "ts", "pot"]
```

https://github.com/lokalise/i18n-ally/wiki/Locale-Formats

#### 最后翻译效果如图

![avatar](/img/i18n-ally.png)
